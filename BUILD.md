# 构建说明

## 构建脚本功能

本项目提供了跨平台的构建脚本，支持同时构建 Windows 和 Linux 版本。

### 主要特性

1. **版本化构建**：运行时输入版本号，生成版本化的输出目录
2. **跨平台支持**：同时构建 Windows (amd64) 和 Linux (amd64) 版本
3. **强制前端重构建**：每次都会重新构建前端，确保使用最新代码
4. **版本注入**：构建时将版本号注入到可执行文件中

### 使用方法

#### Windows 环境

```bash
# 中文版本（推荐）
build.bat

# 英文版本（如果中文版本有编码问题）
build-en.bat
```

运行后会提示输入版本号，例如：`1.0.0`

**注意：** 如果遇到中文编码问题，请使用 `build-en.bat` 英文版本。

#### Linux/macOS 环境

```bash
chmod +x build.sh
./build.sh
```

运行后会提示输入版本号，例如：`1.0.0`

### 输出结构

构建完成后，文件会保存在 `bin/版本号/` 目录下：

```
bin/
└── 1.0.0/
    ├── verkeyoss-windows-amd64.exe
    └── verkeyoss-linux-amd64
```

### 构建流程

1. 输入版本号
2. 创建版本化输出目录 `bin/版本号/`
3. 清理并重新构建前端（`frontend/dist`）
4. 构建 Windows amd64 版本
5. 构建 Linux amd64 版本
6. 显示构建结果和文件大小

### 版本信息

构建时会将版本号注入到可执行文件中，启动时会显示版本信息：

```
VerKeyOSS 版本: 1.0.0
```

前端也会从后端获取版本信息并在界面上显示：
- 顶部导航栏显示版本标签
- 仪表盘系统信息卡片显示详细版本信息
- 健康检查接口返回版本号

### 注意事项

1. 确保 Node.js 和 npm 已安装（用于构建前端）
2. 确保 Go 1.19+ 已安装
3. 首次构建前端时需要先运行 `npm install` 安装依赖
4. 构建过程中会清理 `frontend/dist` 目录，确保使用最新前端代码

### 环境要求

- Go 1.19+
- Node.js 16+
- npm 或 yarn
- Git（可选，用于版本管理）

### 故障排除

1. **前端构建失败**：检查 Node.js 版本，确保依赖已安装
2. **Go 构建失败**：检查 Go 版本和模块依赖
3. **权限问题**：在 Linux/macOS 上确保脚本有执行权限
4. **Windows 中文编码问题**：如果 `build.bat` 出现编码错误，请使用 `build-en.bat` 英文版本